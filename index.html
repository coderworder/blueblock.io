<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BlueBlock Pro — polished dark obfuscator (coderworder)</title>

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
/* =========================
   BlueBlock Pro — single-file styles
   Polished dark theme, multi-theme support via [data-theme]
   ========================= */

/* Reset */
* { box-sizing: border-box; margin:0; padding:0; }
html,body { height:100%; }
body {
  font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: #05060a;
  color: #e6f0ff;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  user-select: none;
  line-height:1.35;
}

/* Theme variables (default blue). Swapped by data-theme on <html> */
:root{
  --bg: #070812;
  --panel: rgba(11,18,35,0.7);
  --glass: rgba(11,18,35,0.45);
  --accent: #1b5eff;
  --accent-strong: #2fa3ff;
  --muted: #8fa8dc;
  --success: #3cff95;
  --danger: #ff5973;
  --shadow: 0 10px 40px rgba(27,94,255,0.12);
  --radius: 14px;
  --glass-blur: 14px;
  --ease: cubic-bezier(.2,.9,.2,1);
}

/* Ruby */
[data-theme="ruby"]{
  --bg: #0b0708;
  --panel: rgba(30,10,13,0.78);
  --glass: rgba(30,10,13,0.55);
  --accent: #ff1144;
  --accent-strong: #ff5577;
  --muted: #d599a7;
  --shadow: 0 12px 36px rgba(255,17,68,0.09);
}
/* Amethyst */
[data-theme="amethyst"]{
  --bg: #0f0c18;
  --panel: rgba(26,18,46,0.78);
  --glass: rgba(26,18,46,0.52);
  --accent: #a44aff;
  --accent-strong: #c28bff;
  --muted: #bca6d8;
  --shadow: 0 12px 36px rgba(164,74,255,0.09);
}
/* Ghastly */
[data-theme="ghastly"]{
  --bg: #000000;
  --panel: rgba(8,8,10,0.85);
  --glass: rgba(12,12,14,0.6);
  --accent: #39fffc;
  --accent-strong: #6effff;
  --muted: #7fc0bf;
  --shadow: 0 12px 36px rgba(57,255,252,0.06);
}

/* App container */
#app {
  max-width:1180px;
  margin:28px auto;
  height: calc(100vh - 56px);
  border-radius:18px;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  background: linear-gradient(180deg, var(--panel), rgba(0,0,0,0.35));
  box-shadow: var(--shadow), inset 0 0 50px rgba(0,0,0,0.6);
}

/* Topbar */
#topbar{
  height:64px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 18px;
  background: linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  backdrop-filter: blur(var(--glass-blur));
  -webkit-backdrop-filter: blur(var(--glass-blur));
  border-bottom: 1px solid rgba(255,255,255,0.02);
}
.brand{
  display:flex; align-items:center; gap:12px;
}
.brand .logo{
  width:44px; height:44px; border-radius:10px;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  box-shadow: 0 6px 18px rgba(0,0,0,0.6), inset 0 2px 8px rgba(255,255,255,0.02);
  display:flex; align-items:center; justify-content:center; font-weight:800; color:var(--accent);
  font-size:18px;
}
.brand h1{ font-size:18px; letter-spacing:1px; color:var(--accent-strong); }
.brand p{ font-size:12px; color:var(--muted); margin-top:2px; }

/* Top controls (avatar + notifications) */
.top-controls{ display:flex; align-items:center; gap:12px; }
.avatar{
  width:44px; height:44px; border-radius:50%;
  background: url('https://avatars.githubusercontent.com/coderworder') center/cover no-repeat;
  border:2px solid rgba(255,255,255,0.03);
  box-shadow: 0 0 14px rgba(0,0,0,0.6), 0 0 12px rgba(0,0,0,0.2) inset;
}
.username{ font-weight:600; color:var(--accent-strong); margin-left:6px; }

/* Notifications */
.notif-btn{
  position:relative;
  background:transparent;border:none;color:var(--accent);cursor:pointer;padding:8px;border-radius:8px;
}
.notif-badge{position:absolute; right:6px; top:6px; width:10px;height:10px;border-radius:50%; background:var(--danger); border:2px solid var(--panel); box-shadow:0 0 6px var(--danger);}
.notif-panel{
  position:absolute; right:18px; top:74px; width:300px; max-height:360px; overflow:auto;
  background:var(--panel); border-radius:12px; box-shadow:var(--shadow); padding:8px;
  transform-origin:top right; display:none;
}
.notif-panel.visible{ display:block; animation:fadeIn 260ms var(--ease) both; }

@keyframes fadeIn { from {opacity:0; transform: translateY(-6px) scale(.98);} to {opacity:1; transform: translateY(0) scale(1);} }

/* Main nav tabs */
#tabs{
  display:flex; gap:12px; justify-content:center; padding:10px 14px; background:linear-gradient(180deg, transparent, rgba(0,0,0,0.03));
  border-bottom:1px solid rgba(255,255,255,0.02);
}
.tab{
  background:transparent; border:none; padding:8px 18px; color:var(--muted); font-weight:700; cursor:pointer; border-radius:10px;
  transition: all 220ms var(--ease);
}
.tab:hover{ color:var(--accent-strong); transform:translateY(-3px); }
.tab.active{ color:white; background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); box-shadow: 0 8px 30px rgba(0,0,0,0.4); }

/* Content area */
#content{ flex:1; position:relative; overflow:hidden; background:linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.45)); padding:20px 26px; }

/* Page layout (each tab is full page) */
.page{
  position:absolute; inset:0; padding:28px; overflow:auto;
  transform:translateX(20px); opacity:0; pointer-events:none; transition: transform 420ms var(--ease), opacity 420ms var(--ease);
}
.page.active{ transform:none; opacity:1; pointer-events:auto; }

/* Page header */
.page-head{ display:flex; align-items:baseline; justify-content:space-between; gap:16px; margin-bottom:18px; }
.page-head h2{ color:var(--accent-strong); font-size:20px; letter-spacing:0.8px; }
.page-sub{ color:var(--muted); font-size:13px; }

/* Grid cards */
.grid{ display:grid; grid-template-columns: 1fr 360px; gap:18px; align-items:start; }
@media (max-width:980px) { .grid{ grid-template-columns: 1fr; } }

/* Card */
.card{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:14px; box-shadow: var(--shadow); border:1px solid rgba(255,255,255,0.02); }

/* Stats */
.stats{ display:flex; gap:12px; }
.stat{ flex:1; padding:12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005)); }
.stat .num{ font-weight:800; font-size:20px; color:white; }
.stat .label{ color:var(--muted); font-size:13px; }

/* Obfuscator styles */
.controls-row{ display:flex; align-items:center; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
.select, .option { background:var(--glass); padding:8px 10px; border-radius:10px; border:1px solid rgba(255,255,255,0.02); color:var(--muted); }
.select select{ background:transparent; color:var(--fg); border:none; font-weight:600; }
.option{ display:flex; align-items:center; gap:8px; }

/* Code editors */
.editor{ width:100%; min-height:320px; border-radius:12px; padding:14px; background: linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.35)); color: #dbe9ff; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace; font-size:13px; border:1px solid rgba(255,255,255,0.02); box-shadow: inset 0 0 20px rgba(0,0,0,0.5); resize:vertical; }

/* Action row */
.action-row{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:12px; flex-wrap:wrap; }
.actions-left{ display:flex; gap:10px; align-items:center; }

/* Buttons */
.btn{ background:var(--accent); color:#011227; padding:10px 14px; border-radius:10px; font-weight:700; border:none; cursor:pointer; box-shadow: 0 8px 30px rgba(27,94,255,0.12); transition: transform 140ms var(--ease); }
.btn:hover{ transform: translateY(-3px); background:var(--accent-strong); }
.btn.ghost{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03); box-shadow:none; }
.spinner{ width:18px; height:18px; border:3px solid rgba(255,255,255,0.06); border-top-color:var(--panel); border-radius:50%; animation: spin 900ms linear infinite; display:inline-block; vertical-align:middle; margin-left:6px; opacity:0; transition:opacity 140ms; }
.busy .spinner{ opacity:1; }

/* Strength slider */
.range { display:flex; align-items:center; gap:8px; }
.range input[type=range]{ accent-color:var(--accent); }

/* Output controls */
.output-box{ margin-top:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.output-controls{ display:flex; gap:8px; }

/* History */
.history-item{ padding:10px; border-radius:10px; margin-bottom:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border:1px solid rgba(255,255,255,0.02); }

/* Settings */
.theme-tiles{ display:flex; gap:10px; margin-top:8px; }
.theme-tile{ padding:10px 14px; border-radius:10px; cursor:pointer; border:1px solid rgba(255,255,255,0.03); color:var(--muted); transition: transform 160ms; }
.theme-tile:hover{ transform:translateY(-4px); color:var(--accent-strong); }
.theme-tile.active{ box-shadow:0 10px 30px rgba(0,0,0,0.5); color:white; }

/* GitHub card */
.gh-card{ display:flex; gap:12px; align-items:center; padding:10px; border-radius:10px; background:var(--glass); border:1px solid rgba(255,255,255,0.02); }
.gh-avatar{ width:56px; height:56px; border-radius:10px; background:url('https://avatars.githubusercontent.com/coderworder') center/cover no-repeat; border:2px solid rgba(255,255,255,0.02); }
.gh-info{ color:var(--muted); font-size:13px; }

/* small utilities */
.muted{ color:var(--muted); font-size:13px; }
.small{ font-size:12px; color:var(--muted); }
.center { display:flex; align-items:center; justify-content:center; }

/* responsive tweaks */
@media (max-width:900px){
  .grid{ grid-template-columns: 1fr; }
  .brand h1{ display:none; }
  .username{ display:none; }
  #topbar{ padding:10px; }
  #app{ margin:12px; height: auto; }
  .editor{ min-height:200px; }
}

/* tiny helper */
.hidden{ display:none !important; }
@keyframes spin{ to { transform:rotate(360deg); } }
</style>
</head>
<body data-theme="blue">

<div id="app" role="application" aria-label="BlueBlock Pro">

  <!-- TOPBAR -->
  <header id="topbar">
    <div class="brand">
      <div class="logo">BB</div>
      <div>
        <h1>BlueBlock Pro</h1>
        <p class="small muted">bluebooks or block idk lol</p>
      </div>
    </div>

    <div style="display:flex;align-items:center;gap:10px;">
      <div style="display:flex;align-items:center;gap:8px;">
        <div class="avatar" id="top-avatar" title="GitHub profile"></div>
        <div class="username" id="top-username">DevMaster</div>
      </div>

      <div style="position:relative;">
        <button class="notif-btn" id="notif-btn" aria-label="Notifications" title="Notifications">
          <!-- bell -->
          <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M12 24c1.326 0 2.4-1.074 2.4-2.4h-4.8c0 1.326 1.074 2.4 2.4 2.4zm6-7.2v-6c0-3.3-2.16-6-5.4-6-3.24 0-5.4 2.7-5.4 6v6l-1.8 1.8v.6h15v-.6l-1.8-1.8z"/></svg>
          <span class="notif-badge" id="notif-badge" title="unread"></span>
        </button>

        <div class="notif-panel" id="notif-panel" aria-hidden="true">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
            <strong style="color:var(--accent-strong)">Notifications</strong>
            <button class="btn ghost" id="clear-notifs">Clear</button>
          </div>
          <div id="notif-items" style="display:flex;flex-direction:column;gap:8px;"></div>
        </div>
      </div>
    </div>
  </header>

  <!-- Tabs -->
  <div id="tabs" role="tablist" aria-label="Main">
    <button class="tab active" data-tab="home" aria-selected="true">Home</button>
    <button class="tab" data-tab="obfuscator" aria-selected="false">Obfuscator</button>
    <button class="tab" data-tab="settings" aria-selected="false">Settings</button>
    <button class="tab" data-tab="logs" aria-selected="false">Logs</button>
  </div>

  <!-- Content -->
  <main id="content">
    <!-- HOME -->
    <section class="page active" id="page-home" aria-labelledby="tab-home">
      <div class="page-head">
        <div><h2>Welcome, coderworder</h2><div class="page-sub">Your polished obfuscation workspace</div></div>
        <div class="small muted">Tip: Alt+1..4 to switch pages · Ctrl/Cmd+Enter to obfuscate</div>
      </div>

      <div class="grid">
        <div>
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <div>
                <h3 style="margin-bottom:6px;">Quick Stats</h3>
                <div style="display:flex;gap:12px;">
                  <div class="stat">
                    <div class="num" id="stat-scripts">0</div>
                    <div class="label muted">Scripts</div>
                  </div>
                  <div class="stat">
                    <div class="num" id="stat-sessions">1</div>
                    <div class="label muted">Sessions</div>
                  </div>
                  <div class="stat">
                    <div class="num" id="stat-uptime">100%</div>
                    <div class="label muted">Uptime</div>
                  </div>
                </div>
              </div>

              <div style="text-align:right;">
                <button class="btn" id="open-obf">Open Obfuscator</button>
                <div class="small muted" style="margin-top:8px;">Last sync: <span id="last-sync">–</span></div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <h3>Recent</h3>
            <div id="recent-list" style="margin-top:8px;" class="muted small">No recent obfuscations yet.</div>
          </div>
        </div>

        <div>
          <div class="card">
            <h3>GitHub Profile</h3>
            <div style="display:flex;gap:12px;align-items:center;">
              <div class="gh-avatar" id="gh-avatar" style="width:72px;height:72px;border-radius:12px;background-image:url('https://avatars.githubusercontent.com/coderworder'); background-size:cover;"></div>
              <div>
                <div id="gh-name" style="font-weight:700">coderworder</div>
                <div id="gh-login" class="muted small">@coderworder</div>
                <div id="gh-bio" class="muted small" style="margin-top:6px;">Loading public bio…</div>
                <div style="margin-top:8px;">
                  <a id="gh-link" href="https://github.com/coderworder" target="_blank" class="btn ghost" style="padding:8px 10px;">View on GitHub</a>
                </div>
              </div>
            </div>
          </div>

          <div class="card" style="margin-top:12px;">
            <h3>Notifications</h3>
            <div id="home-notifs" class="muted small">No notifications yet.</div>
          </div>
        </div>
      </div>
    </section>

    <!-- OBFUSCATOR -->
    <section class="page" id="page-obfuscator" aria-labelledby="tab-obfuscator" hidden>
      <div class="page-head">
        <div><h2>Obfuscator</h2><div class="page-sub">Powerful Lua & JS protections — demo pipeline</div></div>
        <div class="small muted">Controls beneath apply to the obfuscation run</div>
      </div>

      <div class="card" style="margin-bottom:12px;">
        <div class="controls-row">
          <div class="select">
            <label class="small muted">Language</label>
            <select id="lang">
              <option value="lua">Lua</option>
              <option value="js">JavaScript</option>
            </select>
          </div>

          <div class="option"><input type="checkbox" id="opt-str" /><label for="opt-str" class="small muted">String Encryption</label></div>
          <div class="option"><input type="checkbox" id="opt-cf" /><label for="opt-cf" class="small muted">Control Flow</label></div>
          <div class="option"><input type="checkbox" id="opt-junk" /><label for="opt-junk" class="small muted">Junk Code</label></div>
          <div class="option"><input type="checkbox" id="opt-var" /><label for="opt-var" class="small muted">Variable Rename</label></div>

          <div class="range">
            <label class="small muted">Strength</label>
            <input id="strength" type="range" min="1" max="10" value="6">
            <span id="strength-val" class="small muted">6</span>
          </div>
        </div>
      </div>

      <textarea id="editor-in" class="editor" placeholder="Paste your Lua or JavaScript code here...">-- Example: print("Hello world!")</textarea>

      <div class="action-row">
        <div class="actions-left">
          <button class="btn" id="btn-obfuscate">Obfuscate <span class="spinner" id="ob-spinner" aria-hidden="true"></span></button>
          <div class="small muted" style="margin-left:10px;" id="progress-text">Idle</div>
        </div>

        <div class="output-controls">
          <button class="btn ghost" id="btn-copy">Copy</button>
          <button class="btn ghost" id="btn-save">Save</button>
          <button class="btn ghost" id="btn-clear">Clear</button>
        </div>
      </div>

      <textarea id="editor-out" class="editor" placeholder="Obfuscated output will show here..." readonly></textarea>
    </section>

    <!-- SETTINGS -->
    <section class="page" id="page-settings" aria-labelledby="tab-settings" hidden>
      <div class="page-head">
        <div><h2>Settings</h2><div class="page-sub">Theme, profile & preferences</div></div>
        <div class="small muted">Changes apply instantly</div>
      </div>

      <div class="grid" style="grid-template-columns: 1fr 360px;">
        <div>
          <div class="card">
            <h3>Themes</h3>
            <div class="theme-tiles" style="margin-top:10px;">
              <div class="theme-tile active" data-theme="blue">Blue</div>
              <div class="theme-tile" data-theme="ruby">Ruby</div>
              <div class="theme-tile" data-theme="amethyst">Amethyst</div>
              <div class="theme-tile" data-theme="ghastly">Ghastly</div>
            </div>

            <div style="margin-top:12px;">
              <h3>Profile</h3>
              <div style="display:flex;gap:8px;align-items:center;">
                <input id="profile-name" type="text" placeholder="Display name" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--fg)" />
                <button class="btn ghost" id="save-profile">Save</button>
              </div>
              <p class="small muted" style="margin-top:8px;">Your profile name is saved locally.</p>
            </div>
          </div>
        </div>

        <div>
          <div class="card">
            <h3>Connect GitHub</h3>
            <div class="gh-card">
              <div class="gh-avatar" id="settings-gh-avatar" style="width:64px;height:64px;background-image:url('https://avatars.githubusercontent.com/coderworder');"></div>
              <div>
                <div id="settings-gh-name">coderworder</div>
                <div id="settings-gh-login" class="muted small">@coderworder</div>
                <div id="settings-gh-bio" class="muted small">Client-side profile fetch is enabled</div>
              </div>
            </div>

            <div style="margin-top:10px; display:flex; gap:8px;">
              <input id="gh-username" type="text" placeholder="github username" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--fg)" />
              <button class="btn" id="gh-connect">Connect</button>
              <button class="btn ghost" id="gh-clear">Clear</button>
            </div>
            <div class="small muted" style="margin-top:8px;">Public profile only — no OAuth. For real sign-in you need an OAuth backend.</div>
          </div>

          <div class="card" style="margin-top:12px;">
            <h3>Preferences</h3>
            <div style="display:flex;flex-direction:column;gap:10px;">
              <label class="small muted"><input type="checkbox" id="pref-sound" checked /> Enable subtle sounds</label>
              <label class="small muted"><input type="checkbox" id="pref-confirm" /> Confirm before clearing output</label>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- LOGS -->
    <section class="page" id="page-logs" aria-labelledby="tab-logs" hidden>
      <div class="page-head">
        <div><h2>History / Logs</h2><div class="page-sub">Local history of previous obfuscations</div></div>
        <div class="small muted">Saved locally, up to 100 entries</div>
      </div>

      <div class="card" id="logs-card" style="min-height:200px;">
        <div id="logs-list" style="display:flex;flex-direction:column;gap:10px;"></div>
      </div>
    </section>

  </main>
</div>

<script>
/* =========================
   BlueBlock Pro — single-file script
   - Tabs & animations
   - Theme switching
   - GitHub fetch for coderworder by default
   - Obfuscation demo pipeline (client-side)
   - Notifications, sounds, history
   ========================= */

/* Helpers */
const $ = (s, root=document) => root.querySelector(s);
const $$ = (s, root=document) => Array.from(root.querySelectorAll(s));
const set = (k,v) => localStorage.setItem(k, JSON.stringify(v));
const get = (k, def=null) => { try { return JSON.parse(localStorage.getItem(k)); } catch(e) { return def; } };

/* Elements */
const tabs = $$('#tabs .tab');
const pages = $$('.page');
const notifBtn = $('#notif-btn');
const notifPanel = $('#notif-panel');
const notifItems = $('#notif-items');
const notifBadge = $('#notif-badge');

const editorIn = $('#editor-in');
const editorOut = $('#editor-out');
const btnObfuscate = $('#btn-obfuscate');
const spinner = $('#ob-spinner');
const progressText = $('#progress-text');

const langSel = $('#lang');
const optStr = $('#opt-str');
const optCF = $('#opt-cf');
const optJunk = $('#opt-junk');
const optVar = $('#opt-var');
const strength = $('#strength');
const strengthVal = $('#strength-val');

const btnCopy = $('#btn-copy'), btnSave = $('#btn-save'), btnClear = $('#btn-clear');

const themeTiles = $$('.theme-tile');
const ghAvatar = $('#gh-avatar'), ghName = $('#gh-name'), ghLogin = $('#gh-login'), ghBio = $('#gh-bio'), ghLink = $('#gh-link');

const settingsGhAvatar = $('#settings-gh-avatar'), settingsGhName = $('#settings-gh-name'), settingsGhLogin = $('#settings-gh-login'), settingsGhBio = $('#settings-gh-bio');

const ghInput = $('#gh-username');
const ghConnect = $('#gh-connect'), ghClear = $('#gh-clear');

const prefSound = $('#pref-sound');
const profName = $('#profile-name');

const logsList = $('#logs-list');

const openObf = $('#open-obf');
const lastSync = $('#last-sync');
const recentList = $('#recent-list');
const statScripts = $('#stat-scripts');

/* Local keys */
const KEY_THEME = 'bb_theme_v2';
const KEY_HISTORY = 'bb_history_v2';
const KEY_GH = 'bb_gh_v2';
const KEY_PREFS = 'bb_prefs_v2';
const KEY_PROFILE = 'bb_profile_v2';

/* init theme */
const initialTheme = localStorage.getItem(KEY_THEME) || 'blue';
document.documentElement.setAttribute('data-theme', initialTheme);
themeTiles.forEach(t => {
  t.classList.toggle('active', t.dataset.theme === initialTheme);
  t.addEventListener('click', () => {
    themeTiles.forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    document.documentElement.setAttribute('data-theme', t.dataset.theme);
    localStorage.setItem(KEY_THEME, t.dataset.theme);
    play('switch');
  });
});

/* Tabs */
function activate(tabEl){
  tabs.forEach(t => { t.classList.remove('active'); t.setAttribute('aria-selected', 'false'); });
  pages.forEach(p => { p.classList.remove('active'); p.hidden = true; });

  tabEl.classList.add('active');
  tabEl.setAttribute('aria-selected','true');
  const name = tabEl.dataset.tab;
  const page = document.getElementById('page-' + name);
  if(page){ page.classList.add('active'); page.hidden = false; page.scrollTop = 0; }
  play('click');
}
tabs.forEach(t => t.addEventListener('click', ()=> activate(t)));

// keyboard shortcuts Alt+1..4
window.addEventListener('keydown', e => {
  if(e.altKey && !e.ctrlKey && !e.metaKey && !e.shiftKey){
    const n = Number(e.key);
    if(n >=1 && n <= tabs.length) {
      activate(tabs[n-1]);
    }
  }
  // Ctrl/Cmd + Enter to obfuscate
  if((e.ctrlKey || e.metaKey) && e.key === 'Enter'){ if(document.activeElement === editorIn || document.activeElement === editorOut) { obfuscate(); } }
});

/* Notifications */
function notify(text, type='info'){
  const el = document.createElement('div'); el.className = 'notif-item';
  el.textContent = text;
  if(type === 'success') el.style.color = 'var(--success)';
  if(type === 'error') el.style.color = 'var(--danger)';
  notifItems.prepend(el);
  // badge
  notifBadge.style.display = 'block';
  setTimeout(()=> { if(el.parentNode) el.remove(); }, 8000);
}
notifBtn.addEventListener('click', e => {
  const open = notifPanel.classList.toggle('visible');
  notifPanel.setAttribute('aria-hidden', String(!open));
});
$('#clear-notifs') && $('#clear-notifs').addEventListener('click', ()=> { notifItems.innerHTML=''; notifBadge.style.display='none'; });

/* GitHub fetch for coderworder by default */
async function fetchGitHub(user){
  try {
    const res = await fetch('https://api.github.com/users/' + encodeURIComponent(user));
    if(!res.ok) throw new Error('Not found');
    return await res.json();
  } catch(e){ throw e; }
}

/* apply profile to UI */
async function loadProfile(user='coderworder'){
  try{
    const profile = await fetchGitHub(user);
    $('#top-avatar').style.backgroundImage = `url(${profile.avatar_url})`;
    $('#top-username').textContent = profile.name || profile.login || user;
    ghAvatar.style.backgroundImage = `url(${profile.avatar_url})`;
    settingsGhAvatar.style.backgroundImage = `url(${profile.avatar_url})`;
    ghName.textContent = profile.name || profile.login;
    ghLogin.textContent = '@' + profile.login;
    ghBio.textContent = profile.bio || '';
    settingsGhName.textContent = profile.name || profile.login;
    settingsGhLogin.textContent = '@' + profile.login;
    settingsGhBio.textContent = (profile.public_repos || 0) + ' repos • ' + (profile.followers || 0) + ' followers';
    $('#gh-link') && $('#gh-link').setAttribute('href', profile.html_url);
    $('#settings-gh-bio').textContent = profile.bio || '';
    localStorage.setItem(KEY_GH, JSON.stringify({login:profile.login, avatar:profile.avatar_url, name:profile.name, bio:profile.bio}));
    notify('Loaded GitHub profile: ' + profile.login, 'success');
    lastSync.textContent = new Date().toLocaleString();
  } catch(err){
    notify('Failed to load GitHub: ' + (err.message||''), 'error');
  }
}

/* load saved GH if present */
(function(){
  const saved = localStorage.getItem(KEY_GH);
  if(saved){
    try {
      const p = JSON.parse(saved);
      $('#top-avatar').style.backgroundImage = `url(${p.avatar})`;
      $('#top-username').textContent = p.name || p.login;
      ghAvatar.style.backgroundImage = `url(${p.avatar})`;
      settingsGhAvatar.style.backgroundImage = `url(${p.avatar})`;
      settingsGhName.textContent = p.name || p.login;
      settingsGhLogin.textContent = '@' + (p.login || '');
    } catch(e){ loadProfile('coderworder'); }
  } else {
    loadProfile('coderworder'); // default fetch
  }
})();

/* Connect / Clear GH from settings */
ghConnect.addEventListener('click', async () => {
  const u = (ghInput.value||'').trim(); if(!u) return notify('Enter GitHub username','error');
  await loadProfile(u);
});
ghClear.addEventListener('click', ()=>{
  localStorage.removeItem(KEY_GH);
  ghAvatar.style.backgroundImage = ''; settingsGhAvatar.style.backgroundImage = '';
  settingsGhName.textContent = 'Not connected'; settingsGhLogin.textContent = '';
  notify('Cleared GitHub connection', 'info');
});

/* preferences */
const prefs = get(KEY_PREFS) || {sounds:true, confirmClear:true};
prefSound.checked = prefs.sounds; $('#pref-confirm').checked = prefs.confirmClear;
prefSound.addEventListener('change', ()=> { prefs.sounds = prefSound.checked; set(KEY_PREFS,prefs); });
$('#pref-confirm').addEventListener('change', ()=> { prefs.confirmClear = $('#pref-confirm').checked; set(KEY_PREFS,prefs); });

/* profile name save */
profName.value = (get(KEY_PROFILE) || {}).displayName || '';
profName.addEventListener('change', ()=> {
  const v = profName.value.trim();
  localStorage.setItem(KEY_PROFILE, JSON.stringify({displayName:v}));
  if(v) $('#top-username').textContent = v;
  notify('Profile name saved','success');
});

/* simple sound fx */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
function play(type='click'){
  if(!prefs.sounds) return;
  if(!AudioCtx) return;
  const ctx = new AudioCtx();
  const o = ctx.createOscillator(); const g = ctx.createGain();
  o.connect(g); g.connect(ctx.destination);
  const now = ctx.currentTime;
  switch(type){
    case 'click': o.frequency.setValueAtTime(700, now); g.gain.setValueAtTime(0.06, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.12); break;
    case 'success': o.frequency.setValueAtTime(900, now); g.gain.setValueAtTime(0.08, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.22); break;
    case 'error': o.frequency.setValueAtTime(300, now); g.gain.setValueAtTime(0.12, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.28); break;
    case 'switch': o.frequency.setValueAtTime(1100, now); g.gain.setValueAtTime(0.05, now); g.gain.exponentialRampToValueAtTime(0.001, now+0.15); break;
  }
  o.type = 'sine'; o.start(now); o.stop(now+0.12);
}

/* history */
let history = get(KEY_HISTORY) || [];
function saveHistory(){ set(KEY_HISTORY, history); renderHistory(); }
function addHistoryEntry(entry){
  history.unshift(entry); if(history.length>100) history.length = 100; saveHistory(); notify('Saved to history','success'); play('success');
}
function renderHistory(){
  logsList.innerHTML = '';
  if(history.length===0){ logsList.innerHTML = '<div class="muted">No history yet.</div>'; return; }
  history.forEach((h, idx) => {
    const el = document.createElement('div'); el.className='history-item';
    el.innerHTML = `<div style="flex:1"><strong>${h.lang.toUpperCase()} • ${new Date(h.time).toLocaleString()}</strong>
      <div class="muted small">options: ${Object.keys(h.options).filter(k=>h.options[k] && k!=='strength').join(', ') || 'none'} • strength: ${h.options.strength}</div>
      <details style="margin-top:8px;"><summary>Output snippet</summary><pre style="white-space:pre-wrap">${escapeHtml(h.output.slice(0,400))}...</pre></details></div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button class="btn ghost" data-copy>Copy</button>
        <button class="btn ghost" data-run>Re-run</button>
      </div>`;
    el.querySelector('[data-copy]').addEventListener('click', ()=> { navigator.clipboard.writeText(h.output); notify('Copied from history','success'); });
    el.querySelector('[data-run]').addEventListener('click', ()=> { editorIn.value = h.input; activateTabByName('obfuscator'); });
    logsList.appendChild(el);
  });
}
renderHistory();

/* util */
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

/* Activate tab by name (helper) */
function activateTabByName(name){
  const t = tabs.find(x=>x.dataset.tab===name);
  if(t) activate(t);
}

/* Open obfuscator quick */
openObf && openObf.addEventListener('click', ()=> activateTabByName('obfuscator'));

/* Strength display */
strength.addEventListener('input', ()=> { strengthVal.textContent = strength.value; });

/* Obfuscation demo pipeline (client-side; replace for production) */
function variableRename(code){
  const ids = new Set(); const re = /\b([a-zA-Z_][a-zA-Z0-9_]*)\b/g; let m;
  const reserved = new Set(['function','if','then','else','end','local','return','for','while','do','true','false','nil','var','let','const','new','switch','case','break']);
  while((m=re.exec(code))){ const n=m[1]; if(!reserved.has(n) && n.length>1) ids.add(n); }
  const map = {}; const chars='abcdefghijklmnopqrstuvwxyz';
  ids.forEach(n => { let r=''; for(let i=0;i<2+Math.floor(Math.random()*3);i++) r+= chars[Math.floor(Math.random()*chars.length)]; map[n]=r; });
  let out = code; Object.entries(map).forEach(([a,b])=> out = out.replace(new RegExp('\\b'+a+'\\b','g'), b)); return out;
}
function stringEncrypt(code, lang){
  return code.replace(/(["'`])(?:(?=(\\?))\2.)*?\1/g, (m)=> {
    const s = m.slice(1,-1); const arr = Array.from(s).map(c=>c.charCodeAt(0));
    if(lang==='js') return '(()=>{let s=\"\";['+arr.join(',')+'].forEach(c=>s+=String.fromCharCode(c));return s;})()';
    return "((function() local s=''; local a={" + arr.join(',') + "} for i=1,#a do s = s .. string.char(a[i]) end return s end)())";
  });
}
function controlFlowWrap(code, lang){
  if(lang==='js') return `(()=>{let _pc=0;while(true){switch(_pc){case 0:${code}return;}}})();`;
  return `do local _pc=1; ${code}; end`;
}
function junkInject(code, lang){
  const junk = lang==='js' ? ['const _j=0;','// junk'] : ['local _j=0','-- junk'];
  const lines = code.split('\\n'); for(let i=0;i<lines.length;i+=3) if(Math.random()>0.6) lines.splice(i,0,junk[Math.floor(Math.random()*junk.length)]);
  return lines.join('\\n');
}

/* Main obfuscate workflow */
async function obfuscate(){
  const input = editorIn.value.trim();
  if(!input){ notify('Paste code first','error'); return; }
  // options
  const options = { str: optStr.checked, cf: optCF.checked, junk: optJunk.checked, varr: optVar.checked, strength: Number(strength.value) || 5 };
  btnObfuscateDisable(true);
  progressText.textContent = 'Initializing...';
  spinner.style.visibility = 'visible';

  play('click');

  // fake progressive steps with await
  await sleep(300);
  progressText.textContent = 'Preparing code';
  await sleep(400);

  let out = input;

  if(options.varr){ out = variableRename(out); progressText.textContent = 'Renaming variables'; await sleep(350); }
  if(options.str){ out = stringEncrypt(out, langSelValue()); progressText.textContent = 'Encrypting strings'; await sleep(450); }
  if(options.cf){ out = controlFlowWrap(out, langSelValue()); progressText.textContent = 'Flattening control flow'; await sleep(550); }
  if(options.junk){ out = junkInject(out, langSelValue()); progressText.textContent = 'Injecting junk'; await sleep(400); }

  // repeat based on strength (light)
  for(let i=1;i<options.strength;i++){
    if(options.junk && Math.random()>0.5){ out = junkInject(out, langSelValue()); progressText.textContent = `Extra pass (${i})`; await sleep(180); }
  }

  out = `-- BlueBlock Pro (demo) • strength=${options.strength} --\\n` + out;

  editorOut.value = out;
  progressText.textContent = 'Complete';
  spinner.style.visibility = 'hidden';
  btnObfuscateDisable(false);
  addHistoryEntry({ time: new Date().toISOString(), lang: langSelValue(), options, input, output: out });
  renderHistory(); // update logs
}

/* small helpers */
function sleep(ms){ return new Promise(r=>setTimeout(r, ms)); }
function btnObfuscateDisable(v){ btnObfuscate.disabled = v; btnObfuscate.classList.toggle('busy', v); }

/* bind obfuscate */
btnObfuscate.addEventListener('click', obfuscate);

/* copy/save/clear */
btnCopy.addEventListener('click', async ()=> {
  if(!editorOut.value) return notify('Nothing to copy','error');
  try { await navigator.clipboard.writeText(editorOut.value); notify('Copied output','success'); } catch(e) { notify('Copy failed','error'); }
});
btnClear.addEventListener('click', ()=> {
  if($('#pref-confirm').checked && !confirm('Clear input and output?')) return;
  editorIn.value=''; editorOut.value=''; notify('Cleared editors','info');
});
btnSave.addEventListener('click', ()=> {
  if(!editorOut.value) return notify('Nothing to save','error');
  const blob = new Blob([editorOut.value], {type:'text/plain;charset=utf-8'});
  const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = 'obfuscated.txt';
  document.body.appendChild(link); link.click(); link.remove(); notify('Saved file','success');
});

/* render history into logs & sidebar recent */
function renderHistory(){
  renderHistoryList();
  // sidebar recent
  recentList.innerHTML = '';
  if(history.length===0) recentList.textContent = 'No recent obfuscations.';
  else {
    const latest = history.slice(0,4);
    latest.forEach(h => {
      const el = document.createElement('div'); el.className='muted small';
      el.innerHTML = `${new Date(h.time).toLocaleString()} • ${h.lang.toUpperCase()} • s=${h.options.strength}`;
      recentList.appendChild(el);
    });
  }
  statScripts.textContent = history.length;
}
renderHistory();

/* renders logs list */
function renderHistoryList(){
  logsList.innerHTML = '';
  if(history.length===0) { logsList.innerHTML = '<div class="muted">No history yet.</div>'; return; }
  history.forEach(h => {
    const wrap = document.createElement('div'); wrap.className='history-item';
    wrap.innerHTML = `<div style="flex:1">
      <div style="font-weight:700">${h.lang.toUpperCase()} • ${new Date(h.time).toLocaleString()}</div>
      <div class="muted small">options: ${Object.keys(h.options).filter(k=>h.options[k] && k!=='strength').join(', ') || 'none'} • strength: ${h.options.strength}</div>
      <details style="margin-top:8px;"><summary>Output snippet</summary><pre style="white-space:pre-wrap">${escapeHtml(h.output.slice(0,600))}</pre></details></div>
      <div style="display:flex;flex-direction:column;gap:6px">
        <button class="btn ghost" data-copy>Copy</button>
        <button class="btn ghost" data-run>Rerun</button>
      </div>`;
    wrap.querySelector('[data-copy]').addEventListener('click', ()=> { navigator.clipboard.writeText(h.output); notify('Copied output','success'); });
    wrap.querySelector('[data-run]').addEventListener('click', ()=> { editorIn.value = h.input; activateTabByName('obfuscator'); });
    logsList.appendChild(wrap);
  });
}

/* activate by name helper used by rerun */
function activateTabByName(name){
  const el = tabs.find(t => t.dataset.tab === name);
  if(el) activate(el);
}

/* initial bindings for open obf btn */
openObf && openObf.addEventListener('click', ()=> activateTabByName('obfuscator'));

/* renderHistory initially */
renderHistory();

/* small helper to get lang */
function langSelValue(){ return langSel.value || 'lua'; }

/* addHistoryEntry wrapper to save input/out */
function addHistoryEntry(entry){
  history.unshift(entry);
  if(history.length>100) history.length = 100;
  set(KEY_HISTORY, history); renderHistory();
}

/* load saved preferences */
(function loadPrefs(){
  const p = get(KEY_PREFS) || {sounds:true, confirmClear:true};
  prefSound.checked = p.sounds;
  $('#pref-confirm').checked = p.confirmClear;
  const prof = get(KEY_PROFILE); if(prof && prof.displayName) { $('#top-username').textContent = prof.displayName; profName.value = prof.displayName; }
})();

/* GH connect from settings: */
ghConnect.addEventListener('click', ()=> {
  const u = (ghInput.value||'').trim(); if(!u) { notify('Enter username','error'); return; }
  loadProfile(u);
});
ghClear.addEventListener('click', ()=> {
  localStorage.removeItem(KEY_GH); notify('Cleared GH', 'info');
  settingsGhAvatar.style.backgroundImage=''; settingsGhName.textContent='Not connected'; settingsGhLogin.textContent=''; settingsGhBio.textContent='';
});

/* helper escape */
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

/* Save and persist some UI state on unload */
window.addEventListener('beforeunload', ()=> {
  set(KEY_PREFS, {sounds:prefSound.checked, confirmClear:$('#pref-confirm').checked});
  set(KEY_PROFILE, {displayName: profName.value.trim()});
});

/* On first load set some UI defaults */
(function firstRun(){
  if(!localStorage.getItem(KEY_THEME)) localStorage.setItem(KEY_THEME, 'blue');
  // quickly sync lastSync
  lastSync.textContent = new Date().toLocaleString();
})();

</script>
</body>
</html>
